# 馬券会議 - 作業ユニット分割計画

## 概要
本計画は、36件のユーザーストーリーを並行開発可能な作業ユニット（境界づけられたコンテキスト）に分割するためのステップを定義します。

---

## 確認事項

### [Question] 1: ユニット分割の粒度について

現在のエピック構成:
- EPIC-01: AI対話機能（11件）
- EPIC-02: 中毒防止機能（8件）
- EPIC-03: JRA IPAT購入統合（7件）
- EPIC-04: ユーザー管理・認証（10件）

以下のどちらのアプローチを採用しますか？

**A) エピックベース（4ユニット）**
- 現在のエピックをそのまま4つのユニットとして採用
- シンプルで管理しやすい

**B) ドメイン境界ベース（5〜6ユニット）**
- ドメイン駆動設計の境界に基づいてより細かく分割
- 例:
  1. ユーザー認証・管理
  2. レース情報表示
  3. 馬券カート・購入
  4. AI対話・フィードバック
  5. 損益管理・中毒防止
  6. IPAT連携

[Answer]現在のエピックをそのまま4つのユニットとして採用


### [Question] 2: 認証不要機能の扱いについて

EPIC-01のAI対話機能には認証不要の機能（9件）と認証必要の機能（2件）が混在しています。

**A) 同一ユニット内で管理**
- 認証要否をストーリー属性として管理
- ユニット数は少なくなる

**B) 認証要否で別ユニットに分割**
- 認証不要機能は先行開発可能
- ユニット間の依存関係が明確になる

[Answer] 認証要否で別ユニットに分割


### [Question] 3: IPAT購入機能と負け額限度額チェックの関係について

US-03-005（購入時の負け額限度額チェック）はEPIC-03に属していますが、機能的にはEPIC-02（中毒防止機能）と密接に関連しています。

**A) 現在のエピック配置を維持**
- US-03-005はEPIC-03（IPAT購入統合）に維持
- ユニット間の連携として実装

**B) 中毒防止機能ユニットに移動**
- 負け額限度額に関する機能を1つのユニットに集約
- ビジネスルールの一貫性が向上

[Answer] 中毒防止機能ユニットに移動


---

## 回答に基づくユニット構成（確定案）

回答内容:
1. エピックベース（4ユニット）を採用
2. 認証要否で別ユニットに分割
3. US-03-005を中毒防止機能ユニットに移動

### 確定ユニット構成（5ユニット）

| ユニット | 名称 | ストーリー数 | 並行開発 |
|---------|------|-------------|---------|
| Unit 1 | AI対話機能（認証不要） | 9件 | 可（先行開発可能） |
| Unit 2 | AI対話機能（認証必要） | 2件 | Unit 5完了後 |
| Unit 3 | 中毒防止機能 | 9件 | Unit 5完了後 |
| Unit 4 | JRA IPAT購入統合 | 6件 | Unit 5完了後 |
| Unit 5 | ユーザー管理・認証 | 10件 | 可（並行開発可能） |

### ユニット詳細

**Unit 1: AI対話機能（認証不要）** - `unit_01_ai_dialog_public.md`
- US-01-001: レース一覧の表示
- US-01-002: レース詳細情報の表示
- US-01-003: 買い目の入力
- US-01-003a: 買い目のカート追加
- US-01-003b: カートの管理
- US-01-003c: 複数買い目のまとめてAI相談
- US-01-004: AIへの賭け相談
- US-01-005: データに基づくフィードバック
- US-01-006: 掛け金に対するフィードバック

**Unit 2: AI対話機能（認証必要）** - `unit_02_ai_dialog_auth.md`
- US-01-007: 会話履歴の保存
- US-01-008: 会話履歴の閲覧

**Unit 3: 中毒防止機能** - `unit_03_addiction_prevention.md`
- US-02-001: 負け額限度額の初期設定
- US-02-002: 負け額限度額の変更
- US-02-003: 負け額限度額到達時の強制停止
- US-02-004: 負け額限度額接近時のアラート表示
- US-02-005: 損益ダッシュボードの表示
- US-02-006: 損益グラフの表示
- US-02-007: 賭け履歴一覧の表示
- US-02-008: 依存症相談窓口情報の表示
- US-03-005: 購入時の負け額限度額チェック（EPIC-03から移動）

**Unit 4: JRA IPAT購入統合** - `unit_04_ipat_integration.md`
- US-03-001: IPAT認証情報の登録
- US-03-002: IPAT認証情報の変更・削除
- US-03-003: IPAT残高の表示
- US-03-004: 馬券の購入
- US-03-006: 購入結果の自動取得
- US-03-007: 購入履歴の確認

**Unit 5: ユーザー管理・認証** - `unit_05_user_management.md`
- US-04-001: アカウント新規登録
- US-04-002: SNSアカウント連携による登録
- US-04-003: 年齢確認
- US-04-004: 利用規約・プライバシーポリシーへの同意
- US-04-005: ログイン
- US-04-006: ログアウト
- US-04-007: パスワードリセット
- US-04-008: プロフィール情報の編集
- US-04-009: パスワード変更
- US-04-010: アカウント削除

### ユニット間依存関係

```
Unit 1: AI対話機能（認証不要）──────────────────────┐
                                                    │
Unit 5: ユーザー管理・認証 ─────┬───────────────────┤
                               │                   │
                               ▼                   ▼
              Unit 2: AI対話機能（認証必要）   並行開発可能
                               │
                               ▼
              Unit 3: 中毒防止機能 ◄───┐
                               │       │
                               ▼       │ 負け額限度額チェック
              Unit 4: IPAT購入統合 ────┘
```

---

## 作成計画（承認後に実行）

### Phase 1: ユニット構成の確定
- [x] **ステップ 1: 本計画のレビュー・承認** ✓ 2026-01-19

### Phase 2: 各ユニットのドキュメント作成
- [x] **ステップ 2: Unit 1（AI対話機能・認証不要）のmdファイル作成** ✓ 2026-01-19
- [x] **ステップ 3: Unit 2（AI対話機能・認証必要）のmdファイル作成** ✓ 2026-01-19
- [x] **ステップ 4: Unit 3（中毒防止機能）のmdファイル作成** ✓ 2026-01-19
- [x] **ステップ 5: Unit 4（JRA IPAT購入統合）のmdファイル作成** ✓ 2026-01-19
- [x] **ステップ 6: Unit 5（ユーザー管理・認証）のmdファイル作成** ✓ 2026-01-19

### Phase 3: 最終確認
- [x] **ステップ 7: 全ストーリーの網羅性確認（36件）** ✓ 2026-01-19
- [x] **ステップ 8: 本計画書の完了マーク更新** ✓ 2026-01-19

---

## 網羅性確認結果

| ユニット | ストーリー数 | ストーリーID |
|---------|-------------|-------------|
| Unit 1 | 9件 | US-01-001, 002, 003, 003a, 003b, 003c, 004, 005, 006 |
| Unit 2 | 2件 | US-01-007, 008 |
| Unit 3 | 9件 | US-02-001〜008, US-03-005 |
| Unit 4 | 6件 | US-03-001〜004, 006, 007 |
| Unit 5 | 10件 | US-04-001〜010 |
| **合計** | **36件** | **全件網羅 ✓** |

---

## 備考
- 各ユニットのmdファイルには、ユーザーストーリーと受け入れ基準のみを記載します（追加の設計詳細は含めません）
- Unit 1とUnit 5は並行開発可能です
- Unit 2, 3, 4はUnit 5の完了後に開発可能です
