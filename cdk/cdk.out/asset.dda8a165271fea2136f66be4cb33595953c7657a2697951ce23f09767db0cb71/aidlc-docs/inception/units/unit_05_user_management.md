# Unit 5: ユーザー管理・認証

## 概要

| 項目 | 内容 |
|------|------|
| ユニット名 | ユーザー管理・認証 |
| ストーリー数 | 10件 |
| 認証 | 混在（登録・ログイン前は不要、ログイン後機能は必要） |
| 並行開発 | 可（Unit 1と並行開発可能） |
| 依存関係 | なし（他ユニットの前提条件） |

---

## ユーザーストーリー一覧

| ID | タイトル | 優先度 | 認証 |
|----|---------|--------|------|
| US-04-001 | アカウント新規登録 | Must have | 不要 |
| US-04-002 | SNSアカウント連携による登録 | Could have | 不要 |
| US-04-003 | 年齢確認 | Must have | 登録フロー |
| US-04-004 | 利用規約・プライバシーポリシーへの同意 | Must have | 登録フロー |
| US-04-005 | ログイン | Must have | 不要 |
| US-04-006 | ログアウト | Should have | 必要 |
| US-04-007 | パスワードリセット | Should have | 不要 |
| US-04-008 | プロフィール情報の編集 | Could have | 必要 |
| US-04-009 | パスワード変更 | Could have | 必要 |
| US-04-010 | アカウント削除 | Could have | 必要 |

---

## US-04-001: アカウント新規登録

**ストーリー**
> 新規ユーザーとして、メールアドレスとパスワードでアカウントを作成したい。なぜなら、会話履歴の保存や損益管理機能を利用したいから。

| 項目 | 内容 |
|------|------|
| 優先度 | Must have |
| 認証 | 不要（登録前） |
| 対象ペルソナ | 全ペルソナ |

**受け入れ条件**
- [ ] 登録画面でメールアドレス、パスワード、パスワード確認を入力できる
- [ ] メールアドレスの形式が正しくない場合はエラーが表示される
- [ ] パスワード強度インジケーターが表示される（弱/中/強）
- [ ] パスワードは8文字以上、英数字混合が必須
- [ ] パスワードと確認が一致しない場合はエラーが表示される
- [ ] 重複メールアドレスの場合は「既に登録されています」と表示される
- [ ] 登録完了後、確認メールが送信される
- [ ] メール内のリンクをクリックするとアカウントが有効化される

---

## US-04-002: SNSアカウント連携による登録

**ストーリー**
> 新規ユーザーとして、GoogleやAppleアカウントで簡単に登録したい。なぜなら、新しいパスワードを覚えたくないから。

| 項目 | 内容 |
|------|------|
| 優先度 | Could have |
| 認証 | 不要（登録前） |
| 対象ペルソナ | 全ペルソナ |

**受け入れ条件**
- [ ] 登録画面に「Googleで登録」「Appleで登録」ボタンが表示される
- [ ] ボタンタップで各サービスのOAuth認証画面に遷移する
- [ ] 認証成功後、アプリに戻り年齢確認フローに進む
- [ ] 既にアカウントがある場合は「このアカウントは既に存在します」と表示される
- [ ] 設定画面からSNS連携を解除できる

---

## US-04-003: 年齢確認

**ストーリー**
> 新規ユーザーとして、20歳以上であることを確認したい。なぜなら、法的要件を満たして安心してサービスを利用したいから。

| 項目 | 内容 |
|------|------|
| 優先度 | **Must have** |
| 認証 | 登録フロー内 |
| 対象ペルソナ | 全ペルソナ |

**受け入れ条件**
- [ ] 登録フロー内で年齢確認画面が表示される（スキップ不可）
- [ ] 生年月日を年/月/日のセレクターで入力できる
- [ ] 入力した生年月日から年齢が自動計算される
- [ ] 20歳未満の場合は「20歳未満の方はご利用いただけません」と表示される
- [ ] 20歳未満の場合は登録フローが中断される
- [ ] 法的要件に基づく警告文（「競馬は20歳以上の方のみ...」）が表示される

---

## US-04-004: 利用規約・プライバシーポリシーへの同意

**ストーリー**
> 新規ユーザーとして、利用規約とプライバシーポリシーに同意したい。なぜなら、サービスの利用条件を理解して責任を持って利用したいから。

| 項目 | 内容 |
|------|------|
| 優先度 | **Must have** |
| 認証 | 登録フロー内 |
| 対象ペルソナ | 全ペルソナ |

**受け入れ条件**
- [ ] 登録フロー内で利用規約・プライバシーポリシー同意画面が表示される
- [ ] 「利用規約」「プライバシーポリシー」がリンクとして表示される
- [ ] リンクタップで各ドキュメントの全文が閲覧できる
- [ ] チェックボックスで同意を確認する
- [ ] チェックなしでは次のステップに進めない
- [ ] 同意日時がサーバーに記録される

---

## US-04-005: ログイン

**ストーリー**
> 登録済みユーザーとして、メールアドレスとパスワードでログインしたい。なぜなら、自分のデータにアクセスしたいから。

| 項目 | 内容 |
|------|------|
| 優先度 | Must have |
| 認証 | 不要（ログイン前） |
| 対象ペルソナ | 全ペルソナ |

**受け入れ条件**
- [ ] ログイン画面でメールアドレスとパスワードを入力できる
- [ ] 「ログイン状態を保持する」チェックボックスがある
- [ ] ログイン成功時はホーム画面に遷移する
- [ ] ログイン失敗時は「メールアドレスまたはパスワードが正しくありません」と表示される
- [ ] 連続5回失敗するとアカウントが30分間ロックされる
- [ ] ロック中は「しばらくしてから再度お試しください」と表示される
- [ ] 「パスワードを忘れた方」リンクがある

---

## US-04-006: ログアウト

**ストーリー**
> ログインユーザーとして、安全にログアウトしたい。なぜなら、共有デバイスで使用後にアカウントを保護したいから。

| 項目 | 内容 |
|------|------|
| 優先度 | Should have |
| 認証 | **必要** |
| 対象ペルソナ | 全ペルソナ |

**受け入れ条件**
- [ ] 設定画面に「ログアウト」ボタンがある
- [ ] ヘッダーのユーザーメニューに「ログアウト」項目がある
- [ ] ログアウトタップ時に確認ダイアログが表示される
- [ ] ログアウト後はログイン画面にリダイレクトされる
- [ ] セッショントークンがサーバー側で無効化される
- [ ] ローカルに保存されたトークンが削除される

---

## US-04-007: パスワードリセット

**ストーリー**
> パスワードを忘れたユーザーとして、メールでパスワードをリセットしたい。なぜなら、アカウントに再びアクセスしたいから。

| 項目 | 内容 |
|------|------|
| 優先度 | Should have |
| 認証 | 不要 |
| 対象ペルソナ | 全ペルソナ |

**受け入れ条件**
- [ ] ログイン画面に「パスワードを忘れた方」リンクがある
- [ ] リンクタップでパスワードリセット画面に遷移する
- [ ] メールアドレスを入力して「リセットリンクを送信」ボタンをタップできる
- [ ] 送信完了後「メールを送信しました」と表示される
- [ ] メール内のリンクは24時間有効
- [ ] リンクタップで新しいパスワード入力画面に遷移する
- [ ] パスワードリセット完了後、全デバイスからログアウトされる
- [ ] 存在しないメールアドレスでも同じメッセージが表示される（セキュリティ考慮）

---

## US-04-008: プロフィール情報の編集

**ストーリー**
> ログインユーザーとして、自分のプロフィール情報を編集したい。なぜなら、登録情報を最新に保ちたいから。

| 項目 | 内容 |
|------|------|
| 優先度 | Could have |
| 認証 | **必要** |
| 対象ペルソナ | 全ペルソナ |

**受け入れ条件**
- [ ] 設定画面に「プロフィール編集」メニューがある
- [ ] 表示名を編集できる
- [ ] メールアドレスを変更できる（確認メール送信後に反映）
- [ ] 生年月日は表示されるが編集不可（グレーアウト）
- [ ] 変更を保存すると「保存しました」と表示される
- [ ] メールアドレス変更時は確認メールが送信される

---

## US-04-009: パスワード変更

**ストーリー**
> ログインユーザーとして、パスワードを変更したい。なぜなら、定期的にパスワードを更新してセキュリティを高めたいから。

| 項目 | 内容 |
|------|------|
| 優先度 | Could have |
| 認証 | **必要** |
| 対象ペルソナ | 全ペルソナ |

**受け入れ条件**
- [ ] 設定画面に「パスワード変更」メニューがある
- [ ] 現在のパスワード、新しいパスワード、新しいパスワード（確認）を入力できる
- [ ] 現在のパスワードが正しくない場合はエラーが表示される
- [ ] 新しいパスワードの強度インジケーターが表示される
- [ ] 変更完了後「パスワードを変更しました」と表示される
- [ ] 「他のデバイスからログアウトする」チェックボックスがある

---

## US-04-010: アカウント削除

**ストーリー**
> ログインユーザーとして、自分のアカウントを完全に削除したい。なぜなら、サービスの利用をやめたいから。

| 項目 | 内容 |
|------|------|
| 優先度 | Could have |
| 認証 | **必要** |
| 対象ペルソナ | 全ペルソナ |

**受け入れ条件**
- [ ] 設定画面に「アカウント削除」メニューがある（赤色表示）
- [ ] タップすると確認ダイアログが表示される
- [ ] 「この操作は取り消せません」の警告が表示される
- [ ] パスワード再入力が必須
- [ ] 削除完了後、データは30日間保持される（法的要件）
- [ ] 30日以内であれば復旧可能であることが明示される
- [ ] 削除完了後はログイン画面にリダイレクトされる
