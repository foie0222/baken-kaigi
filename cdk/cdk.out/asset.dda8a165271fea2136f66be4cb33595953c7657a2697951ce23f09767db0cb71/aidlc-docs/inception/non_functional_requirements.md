# 馬券会議 - 非機能要件定義書

## 概要
本ドキュメントは、「馬券会議」アプリの非機能要件を定義します。
**セキュリティファースト**の原則に基づき、堅牢なシステムを構築します。

---

## 1. セキュリティ要件（最重要）

### 1.1 認証・認可

| 要件ID | 要件 | 優先度 |
|--------|------|--------|
| SEC-001 | ユーザー認証にはセキュアな方式（OAuth 2.0 / OpenID Connect）を採用する | 必須 |
| SEC-002 | パスワードはbcrypt等の強力なハッシュアルゴリズムで保存する | 必須 |
| SEC-003 | セッション管理にはJWTを使用し、適切な有効期限を設定する | 必須 |
| SEC-004 | 多要素認証（MFA）のオプション提供を検討する | 推奨 |
| SEC-005 | ログイン試行回数の制限（ブルートフォース攻撃対策） | 必須 |

### 1.2 データ保護

| 要件ID | 要件 | 優先度 |
|--------|------|--------|
| SEC-010 | 通信はすべてHTTPS（TLS 1.3）で暗号化する | 必須 |
| SEC-011 | 個人情報・認証情報はAES-256で暗号化して保存する | 必須 |
| SEC-012 | JRA IPAT認証情報は特に厳重に暗号化・管理する | 必須 |
| SEC-013 | データベースへのアクセスは最小権限の原則に従う | 必須 |
| SEC-014 | 機密データのログ出力を禁止する | 必須 |

### 1.3 アプリケーションセキュリティ

| 要件ID | 要件 | 優先度 |
|--------|------|--------|
| SEC-020 | SQLインジェクション対策（パラメータ化クエリの使用） | 必須 |
| SEC-021 | XSS（クロスサイトスクリプティング）対策 | 必須 |
| SEC-022 | CSRF（クロスサイトリクエストフォージェリ）対策 | 必須 |
| SEC-023 | 入力値の厳格なバリデーション | 必須 |
| SEC-024 | セキュリティヘッダーの適切な設定 | 必須 |

### 1.4 監査・監視

| 要件ID | 要件 | 優先度 |
|--------|------|--------|
| SEC-030 | 認証・認可イベントのログ記録 | 必須 |
| SEC-031 | 不正アクセス試行の検知・アラート | 必須 |
| SEC-032 | 定期的なセキュリティ監査の実施 | 推奨 |

---

## 2. 法的要件（必須）

### 2.1 年齢確認

| 要件ID | 要件 | 優先度 |
|--------|------|--------|
| LEG-001 | 登録時に20歳以上であることの確認を必須とする | 必須 |
| LEG-002 | 年齢確認の方法を明確に定義する（自己申告 / 本人確認書類） | 必須 |
| LEG-003 | 未成年者のアクセスを防止する措置を講じる | 必須 |

### 2.2 ギャンブル関連法規

| 要件ID | 要件 | 優先度 |
|--------|------|--------|
| LEG-010 | 競馬法および関連法規を遵守する | 必須 |
| LEG-011 | JRA IPAT利用規約を遵守する | 必須 |
| LEG-012 | 責任あるギャンブルに関するガイドラインを遵守する | 必須 |
| LEG-013 | 依存症相談窓口の情報を提供する | 必須 |

### 2.3 個人情報保護

| 要件ID | 要件 | 優先度 |
|--------|------|--------|
| LEG-020 | 個人情報保護法を遵守する | 必須 |
| LEG-021 | プライバシーポリシーを明示する | 必須 |
| LEG-022 | 個人情報の利用目的を明確にし、同意を取得する | 必須 |
| LEG-023 | ユーザーからのデータ削除要求に対応する | 必須 |

### 2.4 利用規約

| 要件ID | 要件 | 優先度 |
|--------|------|--------|
| LEG-030 | 利用規約を明示し、登録時に同意を取得する | 必須 |
| LEG-031 | 免責事項を明確に記載する | 必須 |
| LEG-032 | 禁止事項を明確に記載する | 必須 |

---

## 3. パフォーマンス要件

| 要件ID | 要件 | 目標値 |
|--------|------|--------|
| PER-001 | ページ読み込み時間 | 3秒以内 |
| PER-002 | API応答時間 | 500ms以内 |
| PER-003 | AI対話応答時間 | 5秒以内 |
| PER-004 | 同時接続ユーザー数 | 初期は100人程度を想定 |
| PER-005 | システム可用性 | 99.5%以上 |

---

## 4. アクセシビリティ要件

### 4.1 対応デバイス

| 要件ID | 要件 | 優先度 |
|--------|------|--------|
| ACC-001 | スマートフォン（iOS / Android）対応 | 必須 |
| ACC-002 | PC（デスクトップブラウザ）対応 | 必須 |
| ACC-003 | タブレット対応 | 推奨 |
| ACC-004 | レスポンシブデザインの採用 | 必須 |

### 4.2 対応ブラウザ

| 要件ID | 要件 | 優先度 |
|--------|------|--------|
| ACC-010 | Chrome（最新版） | 必須 |
| ACC-011 | Safari（最新版） | 必須 |
| ACC-012 | Firefox（最新版） | 推奨 |
| ACC-013 | Edge（最新版） | 推奨 |

### 4.3 ユーザビリティ

| 要件ID | 要件 | 優先度 |
|--------|------|--------|
| ACC-020 | 直感的で使いやすいUI | 必須 |
| ACC-021 | 日本語でのサービス提供 | 必須 |
| ACC-022 | エラーメッセージの明確化 | 必須 |

---

## 5. 可用性・信頼性要件

| 要件ID | 要件 | 目標値 |
|--------|------|--------|
| REL-001 | 計画メンテナンス時間 | 月4時間以内 |
| REL-002 | データバックアップ | 日次 |
| REL-003 | 災害復旧時間（RTO） | 24時間以内 |
| REL-004 | データ復旧ポイント（RPO） | 1時間以内 |

---

## 6. 運用・保守要件

| 要件ID | 要件 | 優先度 |
|--------|------|--------|
| OPS-001 | ログの一元管理・分析 | 必須 |
| OPS-002 | アラート・監視体制の構築 | 必須 |
| OPS-003 | 自動デプロイメント（CI/CD） | 推奨 |
| OPS-004 | ステージング環境の用意 | 推奨 |

---

## 要件サマリー

| カテゴリ | 必須要件数 | 推奨要件数 |
|---------|-----------|-----------|
| セキュリティ | 15 | 2 |
| 法的要件 | 13 | 0 |
| パフォーマンス | 5 | 0 |
| アクセシビリティ | 7 | 4 |
| 可用性・信頼性 | 4 | 0 |
| 運用・保守 | 2 | 2 |
| **合計** | **46** | **8** |
